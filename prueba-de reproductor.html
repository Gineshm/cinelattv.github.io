<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reproductor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .text-outline {
      text-shadow: 1px 1px 2px black;
    }
  </style>
</head>
<body class="bg-black text-white overflow-hidden">
  <div class="relative w-full h-screen">
    <video
      id="video"
      class="w-full h-full object-contain"
      preload="metadata"
      poster="https://placehold.co/600x400/000/FFF?text=Portada"
    >
      <source src="https://archive.org/download/120_20250729/153.mp4" type="video/mp4" />
    </video>

    <!-- Spinner de carga -->
    <div id="spinner" class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-80 z-50">
      <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-red-600 border-opacity-100"></div>
      <p class="mt-4 text-white font-bold text-outline">Cargando Nagi+...</p>
    </div>

    <!-- Controles -->
    <div
      id="controls"
      class="absolute inset-0 flex flex-col justify-between p-4 z-40 pointer-events-none opacity-0 transition-opacity duration-300"
    >
      <!-- Parte superior -->
      <div class="flex justify-between items-center pointer-events-auto">
        <button id="backBtn" onclick="history.back()" class="text-white">
          <i data-lucide="arrow-left" class="w-6 h-6 stroke-white"></i>
        </button>
        <button id="lockBtn" class="text-white">
          <i data-lucide="lock" class="w-6 h-6 stroke-white"></i>
        </button>
      </div>

      <!-- Controles centrales -->
      <div class="flex justify-center items-center space-x-16 pointer-events-auto">
        <button id="rewindBtn">
          <i data-lucide="rotate-ccw" class="w-8 h-8 stroke-white"></i>
        </button>
        <button id="playPauseBtn">
          <i data-lucide="play" class="w-12 h-12 stroke-white"></i>
        </button>
        <button id="forwardBtn">
          <i data-lucide="rotate-cw" class="w-8 h-8 stroke-white"></i>
        </button>
      </div>

      <!-- Parte inferior -->
      <div class="w-full pointer-events-auto">
        <!-- NUEVA BARRA DE PROGRESO -->
        <div class="w-full">
          <div class="flex justify-between text-xs text-white mb-1 text-outline">
            <span id="currentTime">0:00</span>
            <span id="totalTime">0:00</span>
          </div>
          <input
            type="range"
            id="progress"
            min="0"
            max="100"
            value="0"
            class="w-full h-2 accent-red-600 cursor-pointer"
          />
        </div>
        <!-- Botones inferiores -->
        <div class="flex justify-between items-center mt-2">
          <button id="fullscreenBtn">
            <i data-lucide="maximize" class="w-6 h-6 stroke-white"></i>
          </button>
          <button id="episodesBtn">
            <i data-lucide="list-video" class="w-6 h-6 stroke-white"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Botón de desbloqueo -->
    <div
      id="unlockBtn"
      class="hidden absolute top-4 right-4 z-50 pointer-events-auto"
    >
      <button class="text-white">
        <i data-lucide="unlock" class="w-6 h-6 stroke-white"></i>
      </button>
    </div>

    <!-- Botón Saltar Intro -->
    <button
      id="btnSkipIntro"
      class="hidden absolute bottom-24 right-4 z-50 bg-red-600 text-white px-4 py-2 rounded-xl text-sm font-semibold pointer-events-auto"
    >
      Saltar intro
    </button>
  </div>

  <script>
    lucide.createIcons();

    const video = document.getElementById("video");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const rewindBtn = document.getElementById("rewindBtn");
    const forwardBtn = document.getElementById("forwardBtn");
    const controls = document.getElementById("controls");
    const progress = document.getElementById("progress");
    const currentTimeEl = document.getElementById("currentTime");
    const totalTimeEl = document.getElementById("totalTime");
    const spinner = document.getElementById("spinner");
    const lockBtn = document.getElementById("lockBtn");
    const unlockBtn = document.getElementById("unlockBtn");
    const btnSkipIntro = document.getElementById("btnSkipIntro");

    let controlsVisible = false;
    let hideControlsTimeout;
    let locked = false;

    const introEnd = 85; // segundo donde termina la intro
    const storageKey = "videoProgress";

    function toggleControls() {
      if (locked) return;
      controlsVisible = !controlsVisible;
      controls.classList.toggle("opacity-0", !controlsVisible);
      controls.classList.toggle("pointer-events-none", !controlsVisible);
      if (controlsVisible) resetHideTimeout();
    }

    function resetHideTimeout() {
      clearTimeout(hideControlsTimeout);
      hideControlsTimeout = setTimeout(() => {
        controls.classList.add("opacity-0", "pointer-events-none");
        controlsVisible = false;
      }, 3000);
    }

    function formatTime(seconds) {
      if (isNaN(seconds)) return "0:00";
      const hrs = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      const secs = Math.floor(seconds % 60);
      return `${hrs > 0 ? hrs + ":" : ""}${mins}:${secs.toString().padStart(2, "0")}`;
    }

    video.addEventListener("loadedmetadata", () => {
      totalTimeEl.textContent = formatTime(video.duration);
      const savedTime = localStorage.getItem(storageKey);
      if (savedTime) video.currentTime = parseFloat(savedTime);
    });

    video.addEventListener("timeupdate", () => {
      const value = (video.currentTime / video.duration) * 100;
      progress.value = value || 0;
      currentTimeEl.textContent = formatTime(video.currentTime);

      // Mostrar botón Saltar intro
      if (video.currentTime >= 0 && video.currentTime < introEnd) {
        if (!locked) btnSkipIntro.classList.remove("hidden");
      } else {
        btnSkipIntro.classList.add("hidden");
      }
    });

    progress.addEventListener("input", () => {
      resetHideTimeout();
      video.currentTime = (progress.value / 100) * video.duration;
    });

    video.addEventListener("click", toggleControls);

    playPauseBtn.addEventListener("click", () => {
      if (video.paused) {
        video.play();
        playPauseBtn.innerHTML = '<i data-lucide="pause" class="w-12 h-12 stroke-white"></i>';
      } else {
        video.pause();
        playPauseBtn.innerHTML = '<i data-lucide="play" class="w-12 h-12 stroke-white"></i>';
      }
      lucide.createIcons();
    });

    rewindBtn.addEventListener("click", () => {
      video.currentTime -= 10;
      resetHideTimeout();
    });

    forwardBtn.addEventListener("click", () => {
      video.currentTime += 10;
      resetHideTimeout();
    });

    video.addEventListener("playing", () => {
      spinner.style.display = "none";
      playPauseBtn.innerHTML = '<i data-lucide="pause" class="w-12 h-12 stroke-white"></i>';
      lucide.createIcons();
    });

    video.addEventListener("waiting", () => {
      spinner.style.display = "flex";
    });

    lockBtn.addEventListener("click", () => {
      locked = true;
      controls.classList.add("opacity-0", "pointer-events-none");
      unlockBtn.classList.remove("hidden");
    });

    unlockBtn.addEventListener("click", () => {
      locked = false;
      unlockBtn.classList.add("hidden");
      controls.classList.remove("opacity-0", "pointer-events-none");
      controlsVisible = true;
      resetHideTimeout();
    });

    btnSkipIntro.addEventListener("click", () => {
      video.currentTime = introEnd;
      btnSkipIntro.classList.add("hidden");
    });

    window.addEventListener("beforeunload", () => {
      localStorage.setItem(storageKey, video.currentTime);
    });

    document.addEventListener("DOMContentLoaded", () => {
      video.addEventListener("click", toggleControls);
    });
  </script>
</body>
</html>
